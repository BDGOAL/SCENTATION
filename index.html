import React, { useState, useCallback, useEffect } from "react";
import QRCode from "react-qr-code";
import {
  mbtiResults,
  type MBTIType,
  type MBTIPersonality,
} from "./mbti-data";
import { calcMbti, type UserAnswer } from "./calcMbti";
import { questionMetaMap } from "./questionMetaMap";
import { ResultPage } from "./ResultPage";
import { useAnalytics } from "./hooks/useAnalytics";
import { useScreenshot } from "./hooks/useScreenshot";

// Import icon for option A
const iconA =
  "https://raw.githubusercontent.com/BDGOAL/SCENTATION/refs/heads/main/iconA.png";
// Import icon for option B
const iconB =
  "https://raw.githubusercontent.com/BDGOAL/SCENTATION/refs/heads/main/IconB.png";
// Import new logo
import logoImage from "figma:asset/2b7d65a9703d7378f7abb25baa4e6ff42ef58051.png";

// =========================================================
// Types
// =========================================================
type ScoreKey = "N" | "S" | "J" | "P" | "T" | "F" | "E" | "I";
type Page =
  | "intro"
  | "nameInput"
  | 1
  | 2
  | 3
  | 4
  | "result"
  | "share";
type CategoryKey = "NT" | "NF" | "SJ" | "SP";
type Language = "zh-TW" | "en";

interface QuestionOption {
  key: ScoreKey;
  text: string;
}

interface Question {
  id: number;
  title: string;
  options: QuestionOption[];
  image: string;
  progressWidth: number;
}

interface ResultData {
  category: string;
  desc: string;
  fragrance: string;
  products: {
    brand: string;
    name: string;
    image: string;
    notes: string;
    description: string;
  }[];
}

interface TextContent {
  intro: {
    title: string;
    description: string;
    button: string;
  };
  nameInput: {
    title: string;
    subtitle: string;
    placeholder: string;
    button: string;
  };
  header: {
    tagline: string;
  };
  exit: string;
  restart: string;
  share: string;
  result: {
    title: string;
    greeting: string;
    mbtiPrefix: string;
    mbtiSuffix: string;
    recommendation: string;
    recommendationLabel: string;
  };
  shareQR: {
    title: string;
    subtitle: string;
    instruction: string;
    backButton: string;
  };
  resultsMap: Record<CategoryKey, ResultData>;
  questions: Question[];
}

// =========================================================
// Images
// =========================================================
const questionImages = {
  q1: "https://raw.githubusercontent.com/BDGOAL/SCENTATION/refs/heads/main/1.png",
  q2: "https://raw.githubusercontent.com/BDGOAL/SCENTATION/refs/heads/main/2.png",
  q3: "https://raw.githubusercontent.com/BDGOAL/SCENTATION/refs/heads/main/3.png",
  q4: "https://raw.githubusercontent.com/BDGOAL/SCENTATION/refs/heads/main/4.png",
  intro:
    "https://raw.githubusercontent.com/BDGOAL/SCENTATION/refs/heads/main/ChatGPT%20Image%202025%E5%B9%B412%E6%9C%8815%E6%97%A5%20%E4%B8%8B%E5%8D%8803_37_10%201%20(1).png",
};

const productImage =
  "https://images.unsplash.com/photo-1759793500112-c588839cfc6e?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&q=80&w=600";

// Product images
const productImages = {
  NT_Aventus:
    "https://raw.githubusercontent.com/BDGOAL/SCENTATION/refs/heads/main/k11%20musea%20product%20image_Creed_Aventus%20Collection-Aventus_edp.jpg",
  NT_SilverMountainWater:
    "https://raw.githubusercontent.com/BDGOAL/SCENTATION/refs/heads/main/k11%20musea%20product%20image_Creed_Silver%20Mountain%20Water_edp.jpg",
  NT_ForHimBleuNoir:
    "https://raw.githubusercontent.com/BDGOAL/SCENTATION/refs/heads/main/k11%20musea%20product%20image_narciso%20rodriguez_For%20Him%20Bleu%20Noir_edp.jpg",
  NF_Ani:
    "https://raw.githubusercontent.com/BDGOAL/SCENTATION/refs/heads/main/k11%20musea%20product%20image_Nishane_Ani_Extrait.jpg",
  NF_Nanshe:
    "https://raw.githubusercontent.com/BDGOAL/SCENTATION/refs/heads/main/k11%20musea%20product%20image_Nishane_Nanshe_Extrait.jpg",
  NF_Lira:
    "https://raw.githubusercontent.com/BDGOAL/SCENTATION/refs/heads/main/k11%20musea%20product%20image_Xerjoff_Casamorati%20-%20Lira_edp.jpg",
  NF_Zik:
    "https://raw.githubusercontent.com/BDGOAL/SCENTATION/refs/heads/main/k11%20musea%20product%20image_blackfades_zik.jpg",
  SJ_ForHerEDT:
    "https://raw.githubusercontent.com/BDGOAL/SCENTATION/refs/heads/main/k11%20musea%20product%20image_narciso%20rodriguez_For%20Her_edt.jpg",
  SJ_Buongiorno:
    "https://raw.githubusercontent.com/BDGOAL/SCENTATION/refs/heads/main/k11%20musea%20product%20image_Acqua%20di%20Parma_Buongiorno_edp.jpg",
  SJ_Torino23:
    "https://raw.githubusercontent.com/BDGOAL/SCENTATION/refs/heads/main/k11%20musea%20product%20image_Xerjoff_Torino%2023_edp.jpg",
  SP_HardLeather:
    "https://raw.githubusercontent.com/BDGOAL/SCENTATION/refs/heads/main/k11%20musea%20product%20image_LM%20Parfums_Hard%20Leather_Extrait%20de%20parfum.jpg",
  SP_BlackAfgano:
    "https://raw.githubusercontent.com/BDGOAL/SCENTATION/refs/heads/main/k11%20musea%20product%20image_Nasomatto_Black%20Afgano_Extrait%20de%20parfum.jpg",
  SP_VirginIslandWater:
    "https://raw.githubusercontent.com/BDGOAL/SCENTATION/refs/heads/main/k11%20musea%20product%20image_Creed_Virgin%20Island%20Water_edp.jpg",
  SP_Wandervogel:
    "https://raw.githubusercontent.com/BDGOAL/SCENTATION/refs/heads/main/k11%20musea%20product%20image_27%2087_Wandervogel_edp.jpg",
};

// =========================================================
// Translations
// =========================================================
const zh_TW_Content: TextContent = {
  intro: {
    title: "探索您的香氣密碼",
    description:
      "於瞬息萬變的都會節奏中，您的香氣定義了您的氣場。\n迅速剖析核心人格特質，精準推薦最能彰顯您個人魅力的香調。",
    button: "按此啟動 探索香氣",
  },
  nameInput: {
    title: "請輸入您的姓名",
    subtitle: "讓我們為你量身打造香氣體驗",
    placeholder: "輸入姓名",
    button: "開始測試",
  },
  header: {
    tagline: "為您的非凡風格，尋覓您的品味哲學。",
  },
  exit: "✕",
  restart: "重新探索",
  share: "分享結果",
  result: {
    title: "你的香氣個性",
    greeting: "親愛的 [姓名]，",
    mbtiPrefix: "(",
    mbtiSuffix: ")",
    recommendation: "為您推薦的香調",
    recommendationLabel: "最適合您個性的香水",
  },
  shareQR: {
    title: "分享您的香氣個性",
    subtitle: "掃描 QR Code 獲取可分享的結果圖片",
    instruction:
      "使用手機掃描下方 QR Code，\n即可在社交媒體上分享您的專屬香氣結果",
    backButton: "返回結果頁面",
  },
  resultsMap: {
    NT: {
      category: "分析家",
      desc: "作為邏輯至上、追求效率與複雜性的分析家，您不喜歡平庸，偏愛能激發思考或帶有神秘感的氣味。您的香氣必須展現出獨特的品味與智慧。",
      fragrance: "木質調 / 西普調 / 芳香調",
      products: [
        {
          brand: "Creed",
          name: "Aventus",
          image: productImages.NT_Aventus,
          notes:
            "前調：菠蘿、佛手柑、黑醋栗、蘋果\n中調：樺木、廣藿香、茉莉\n後調：麝香、橡苔、龍涎香",
          description:
            "擅長統籌全局與制定策略的你，會被 Aventus 那種煙燻菠蘿配合乾燥木質的結構吸引。這支香水不流於表面的甜美，而是以深度與力量，映照����������的判斷力與清晰的企圖心。",
        },
        {
          brand: "Creed",
          name: "Silver Mountain Water",
          image: productImages.NT_SilverMountainWater,
          notes:
            "前調：佛手柑、橘子\n中調：綠茶、黑醋栗\n後調：檀香、麝香、白松香",
          description:
            "習慣在複雜情境中保持距離與冷靜思考的人，會欣賞 Silver Mountain Water 冷冽茶香與金屬感山泉氣息的克制感。這款香氣既理性又純淨，很貼合你低調卻極具辨識度的存在方式。",
        },
        {
          brand: "Narciso Rodriguez",
          name: "For Him Bleu Noir",
          image: productImages.NT_ForHimBleuNoir,
          notes:
            "前調：豆蔻、肉豆蔻\n中調：麝香\n後調：藍雪松、黑檀木、香根草",
          description:
            "話不多、但每一句都經過思考的性格，與 Bleu Noir 內斂辛香與木質麝香的氣質非常相襯。這支香水不張揚，卻讓留心觀察你的人，感受到你沉穩克制背後的邏輯與深度。",
        },
      ],
    },
    NF: {
      category: "外交官",
      desc: "作為情緒豐富的外交官，您需要暖心、深邃且具有敘事感的香氣。",
      fragrance: "東方調 / 花香調",
      products: [
        {
          brand: "Nishane",
          name: "Ani",
          image:
            "https://raw.githubusercontent.com/BDGOAL/SCENTATION/refs/heads/main/k11%20musea%20product%20image_Nishane_Ani_Extrait.jpg",
          notes: "",
          description:
            "重視情感連結與關係溫度的人，會在 Ani 的香草中聞到一層層被辛香與木質托起的暖意。這支香水像一個循序漸進的擁抱，特別適合用來營造安全感與信任氛圍，讓人自然願意向你打開話題與心事。",
        },
        {
          brand: "Nishane",
          name: "Nanshe",
          image:
            "https://raw.githubusercontent.com/BDGOAL/SCENTATION/refs/heads/main/k11%20musea%20product%20image_Nishane_Nanshe_Extrait.jpg",
          notes: "",
          description:
            "經常成為身邊人心靈樞紐、願意細心傾聽的你，與 Nanshe 帶粉��的玫瑰與皂感氣息十分契合。它就像一條乾淨而溫暖的毛毯，不搶走任何人的焦點，卻總在旁邊提供安穩與支持感。",
        },
        {
          brand: "Casamorati (Xerjoff)",
          name: "Lira",
          image:
            "https://raw.githubusercontent.com/BDGOAL/SCENTATION/refs/heads/main/k11%20musea%20product%20image_Xerjoff_Casamorati%20-%20Lira_edp.jpg",
          notes: "",
          description:
            "擅長以溫柔與幽默打開距離的人，會欣賞 Lira 彷彿檸檬磅蛋糕般的美食香調。香氣像是���份剛出爐的甜點邀請，甜而不膩，讓你的體貼與好相處變得具體，可被記住也容易被親近。",
        },
        {
          brand: "BLACK FADES",
          name: "夕 (zik6)",
          image: productImages.NF_Zik,
          notes: "",
          description:
            "習慣在一天結束前整理思緒、與自己對話的性格，很適合用上「夕 (zik6)」這款以黃昏為意象的香氣。苦檸檬、青檸與絲柏帶出略帶冷調的清新開端，彷彿日光將退未退，城市聲音逐漸安靜下來；隨後松木、苔蘚、岩蘭草、檜木、檀香與雪松堆疊出充滿木質與琥珀感的空間，好像走進只亮著暖燈的小房間，留下專屬於自己、不被打擾的 me-time。",
        },
      ],
    },
    SJ: {
      category: "守護者",
      desc: "作為守護者，您偏愛清晰穩定且專業的香氣。",
      fragrance: "柑橘調 / 清新麝香",
      products: [
        {
          brand: "Narciso Rodriguez",
          name: "For Her EDT",
          image:
            "https://raw.githubusercontent.com/BDGOAL/SCENTATION/refs/heads/main/k11%20musea%20product%20image_narciso%20rodriguez_For%20Her_edt.jpg",
          notes: "",
          description:
            "重視穩定、乾淨與可信度的性格，與 For Her EDT 貼膚麝香的氣質高度呼應。香氣像天生自帶的體香一樣低調卻難以忽視，非常適合通勤、上班或家庭聚會，讓旁人自然把你和細心、體貼與可靠聯想在一起。",
        },
        {
          brand: "Acqua di Parma",
          name: "Buongiorno",
          image:
            "https://raw.githubusercontent.com/BDGOAL/SCENTATION/refs/heads/main/k11%20musea%20product%20image_Acqua%20di%20Parma_Buongiorno_edp.jpg",
          notes: "",
          description:
            "喜歡把每一天安排得井然有序、從早上開始就維持清醒狀態的人，會對 Buongiorno 的草本柑橘香特別有共鳴。它像為自己按下「正���開始」的一鍵啟動，不浮誇卻持續帶來清新有序的感覺，尤其適合需要專注處理細節的工作日早晨。",
        },
        {
          brand: "Xerjoff",
          name: "Torino 23",
          image:
            "https://raw.githubusercontent.com/BDGOAL/SCENTATION/refs/heads/main/k11%20musea%20product%20image_Xerjoff_Torino%2023_edp.jpg",
          notes: "",
          description:
            "同時重視禮貌、儀態與生活節奏的人，會在 Torino 23 身上找到理想的平衡。白花與木質底蘊勾勒出宛如運動後淋浴、換上乾淨衣物的清爽狀態，讓你無論處於正式或休閒場合，都能保持同樣得體而不呆板的形象。",
        },
      ],
    },

    SP: {
      category: "探險家",
      desc: "作為探險家，您需要充滿活力且極具個人色彩的香氣。",
      fragrance: "皮革調 / 辛辣調",
      products: [
        {
          brand: "LM Parfums",
          name: "Hard Leather",
          image:
            "https://raw.githubusercontent.com/BDGOAL/SCENTATION/refs/heads/main/k11%20musea%20product%20image_LM%20Parfums_Hard%20Leather_Extrait%20de%20parfum.jpg",
          notes: "",
          description:
            "樂於嘗試���強���體驗、不介意被形容為「玩得很盡」的人，非常適合 Hard Leather 這種帶動物感的皮革與沈香組合。氣味存在感極強，不刻意取悅所有人，卻清楚保留你敢衝敢試的態度，尤其適合夜晚、派對或需要留下深刻印象的場合。",
        },
        {
          brand: "Nasomatto",
          name: "Black Afgano",
          image:
            "https://raw.githubusercontent.com/BDGOAL/SCENTATION/refs/heads/main/k11%20musea%20product%20image_Nasomatto_Black%20Afgano_Extrait%20de%20parfum.jpg",
          notes: "",
          description:
            "對暗黑美學與實驗性作品抱有強烈好奇心的性格，很容易與 Black Afgano 的厚重樹脂、煙燻與沈香產生共鳴。這支香水像一段不按常理出牌的旅程，適合用來打破他人對你的既定印象，或者為自己保留一份難以被看穿的神秘感。",
        },
        {
          brand: "Creed",
          name: "Virgin Island Water",
          image:
            "https://raw.githubusercontent.com/BDGOAL/SCENTATION/refs/heads/main/k11%20musea%20product%20image_Creed_Virgin%20Island%20Water_edp.jpg",
          notes: "",
          description:
            "一聽到旅行、海島或即興出走就會立刻投入狀���的人，會很適合用 Virgin Island Water 作為標誌性香氣。青檸、椰子與白蘭姆營造出如同行走假期般的氛圍，特別適合夏天、沙灘、音���節���任何你打算輕鬆玩樂的場���。",
        },
        {
          brand: "27 87",
          name: "Wandervogel",
          image:
            "https://raw.githubusercontent.com/BDGOAL/SCENTATION/refs/heads/main/k11%20musea%20product%20image_27%2087_Wandervogel_edp.jpg",
          notes: "",
          description:
            "喜歡說走就走、同時對新科技與新體驗保持高度興趣的人，會被 Wandervogel 帶紫蘇與海風感的前衛清新調吸引。這款香氣不走傳統乖巧路線，而是帶著一點未來感與實驗氣質，正好用來表達你不願被框限的一面。",
        },
      ],
    },
  },
  questions: [
    {
      id: 1,
      title: "鑑賞藝術品時，您的目光最先被什麼吸引？",
      options: [
        {
          key: "N",
          text: "作品背後的哲思、藝術家的抽象概念，以及它給予的無限聯想空間。",
        },
        {
          key: "S",
          text: "作品的材質、精準的技法、生動的色彩表現，以及它所描繪的真實場景。",
        },
      ],
      image: questionImages.q1,
      progressWidth: 366,
    },
    {
      id: 2,
      title: "在緊張的人際衝突中，\n您認為香氣的作用是什麼？",
      options: [
        {
          key: "T",
          text: "幫助我保持清醒和冷靜，散發出專業、不被情緒影響的穩定氣場。",
        },
        {
          key: "F",
          text: "���化周圍的氛圍,創造一個溫暖、撫慰的空間���幫助人與人建立連結。",
        },
      ],
      image: questionImages.q2,
      progressWidth: 692,
    },
    {
      id: 3,
      title: "關於您的香水收藏，\n哪個描述最貼切？",
      options: [
        {
          key: "J",
          text: "我會根據場合、服裝、甚至是一週的計劃，為香水進行精準的分類和選擇。",
        },
        {
          key: "P",
          text: "我隨心所欲地使用香水，喜歡即興疊香，相信氣帶來下的感官喜。",
        },
      ],
      image: questionImages.q3,
      progressWidth: 1081,
    },
    {
      id: 4,
      title: "週末晚上，您渴望散發\n哪一種香氣風格？",
      options: [
        {
          key: "E",
          text: "濃郁、具有魅力且張揚的香氣，希望成為社交聚會中最令人難忘的焦點。",
        },
        {
          key: "I",
          text: "內斂、有層次且舒適的香氣，它是我獨處時的儀式感，只為懂我的人停留。",
        },
      ],
      image: questionImages.q4,
      progressWidth: 1400,
    },
  ],
};

const en_Content: TextContent = {
  intro: {
    title: "Unlock Your Scent Code",
    description:
      "In the fast-paced urban rhythm, your scent defines your aura.\n\nQuickly analyze your core personality traits and receive precise recommendations for a luxury scent that highlights your unique charm.",
    button: "Discover Your Unique Charm",
  },
  nameInput: {
    title: "Enter Your Name",
    subtitle: "Let us tailor a scent experience just for you",
    placeholder: "Your name",
    button: "Start Now",
  },
  header: {
    tagline:
      "The Philosophy of Taste:\nFinding your signature scent for your extraordinary style.",
  },
  exit: "✕",
  restart: "Restart Quiz",
  share: "Share With Friends",
  result: {
    title: "Your Exclusive Fragrance:",
    greeting: "Dear [NAME],",
    mbtiPrefix: " ",
    mbtiSuffix: "",
    recommendation: "Your SCENTATION Recommended Scent:",
    recommendationLabel: "Recommended fragrances:",
  },
  shareQR: {
    title: "Share Your Scent Persona",
    subtitle: "Scan the QR Code to get a sharable result image",
    instruction:
      "Scan the QR Code with your phone\\nto save and share your result on social media.",
    backButton: "Back to Result Page",
  },
  resultsMap: {
    NT: {
      category: "I. The Analysts",
      desc: "As a logic-driven analyst pursuing efficiency and complexity,\nyou dislike mediocrity. You favor scents that provoke thought\nor carry a sense of mystery. Your fragrance must demonstrate\nunique taste and intelligence.",
      fragrance: "Woody / Chypre / Aromatic",
      products: [
        {
          brand: "Creed",
          name: "Aventus",
          image: productImages.NT_Aventus,
          notes: "",
          description:
            'If you enjoy organizing complex situations into clear, actionable plans, Aventus\' smoky pineapple combined with a dry woody structure amplifies your "well-planned and ambitious" side. What others smell is not just a pleasant fruity fragrance, but a person who knows how to control the rhythm and lead the situation.',
        },
        {
          brand: "Creed",
          name: "Silver Mountain Water",
          image: productImages.NT_SilverMountainWater,
          notes: "",
          description:
            "If you prefer to maintain appropriate distance and perspective in interactions, this metallic cold tea scent makes you appear calmer, cleaner, and smarter—as if always standing at a slightly elevated position overlooking the chess board rather than being pushed by emotions.",
        },
        {
          brand: "Narciso Rodriguez",
          name: "For Him Bleu Noir",
          image: productImages.NT_ForHimBleuNoir,
          notes: "",
          description:
            'If you\'re not naturally talkative, Bleu Noir\'s dark woody musk makes your silence "deep" rather than "lacking presence." People will find you difficult to read but simultaneously stable and restrained—like someone who doesn\'t act rashly but is worth listening to carefully when they do speak.',
        },
      ],
    },

    SJ: {
      category: "III. The Sentinels",
      desc: 'As a pragmatic, reliable, and rule-following Sentinel, you favor clear, dependable, and not overly ostentatious "safe" scents. Your fragrance must pass perfectly, bringing a sense of security and professionalism.',
      fragrance: "Fougere / Clean Musk / Citrus",
      products: [
        {
          brand: "Creed",
          name: "Aventus Eau de Parfum",
          image: productImage,
          notes: "Citrus, Jasmine, Amber",
          description:
            "For you, Aventus functions like a tailored suit in scent form. Its balance of freshness, woods, and subtle sweetness supports your dependable image while adding a touch of authority and polish to your everyday presence.",
        },
      ],
    },

    NF: {
      category: "II. The Diplomats",
      desc: "As an emotionally rich diplomat who values interpersonal connection,\\nyou need warm, profound, and narrative scents.\\nYour fragrance will seek emotional support\\nor exude approachable charm in social settings.",
      fragrance: "Oriental / Floral / Gourmand",
      products: [
        {
          brand: "Nishane",
          name: "Ani",
          image: productImages.NF_Ani,
          notes: "",
          description:
            "If you care deeply about the emotional temperature between relationships, Ani's vanilla is not a simple sweetness, but layers of warmth supported by spices and woods, like a slowly tightening embrace.",
        },
        {
          brand: "Nishane",
          name: "Nanshe",
          image: productImages.NF_Nanshe,
          notes: "",
          description:
            "If you often become the person in your friends' eyes who \"understands and listens to the heart,\" Nanshe's powdery rose and soapy scent adds a layer of soft and stable aura to you.",
        },
        {
          brand: "Casamorati (Xerjoff)",
          name: "Lira",
          image: productImages.NF_Lira,
          notes: "",
          description:
            'If you want your first impression to be "easy to get along with, with a touch of sweetness," Lira\'s gourmand scent, like a lemon pound cake, makes you feel like inviting others to sit down and share a freshly baked dessert.',
        },
        {
          brand: "BLACK FADES",
          name: "Zik (夕)",
          image: productImages.NF_Zik,
          notes: "",
          description:
            '"Zik" (夕) refers to the time after dusk when the world gradually quiets down, leaving only yourself in dialogue with your inner self. The opening bitter lemon, lime, and cypress bring a cool freshness. Then, pine, moss, vetiver, hinoki, sandalwood, and cedar create a woody and amber-infused space, like walking into a warmly lit small room after dusk. If you\'re used to organizing thoughts before the day ends and don\'t like overly sweet perfumes, Zik is perfect for "your own evening."',
        },
      ],
    },

    SP: {
      category: "IV. The Explorers",
      desc: "As an Explorer who lives in the moment and loves freedom and excitement,\\nyou need vibrant, dynamic, or strongly individualistic scents.\\nYour fragrance should reflect a fast-paced life\\nand an extroverted personality.",
      fragrance: "Leather / Spicy / Aquatic",
      products: [
        {
          brand: "Creed",
          name: "Aventus Eau de Parfum",
          image: productImage,
          notes: "Citrus, Jasmine, Amber",
          description:
            "On an Explorer personality, Aventus amplifies your love of movement and impact. Its energetic opening and bold trail match your appetite for experience, helping you turn everyday encounters into memorable moments.",
        },
      ],
    },
  },
  questions: [
    {
      id: 1,
      title: "When appreciating art,\nwhat first attracts you?",
      options: [
        {
          key: "N",
          text: "The philosophical ideas behind the work,\nthe artist's abstract concepts,\nand the unlimited associative space it provides.",
        },
        {
          key: "S",
          text: "The material of the work, the precise technique,\nthe vivid color representation,\nand the realistic scene it depicts.",
        },
      ],
      image: questionImages.q1,
      progressWidth: 366,
    },
    {
      id: 2,
      title:
        "In tense conflict,\nwhat role does fragrance play?",
      options: [
        {
          key: "T",
          text: "Helps me stay clear-headed and calm,\nexuding a professional, stable aura\nunaffected by emotions.",
        },
        {
          key: "F",
          text: "Softens the atmosphere,\ncreating a warm, comforting space\nto help build connections between people.",
        },
      ],
      image: questionImages.q2,
      progressWidth: 692,
    },
    {
      id: 3,
      title: "Which best fits\nyour fragrance collection?",
      options: [
        {
          key: "J",
          text: "I categorize and select fragrances precisely\nbased on the occasion, outfit,\nor even my weekly plan.",
        },
        {
          key: "P",
          text: "I use fragrances spontaneously,\nenjoying impromptu layering,\ntrusting the sensory surprise.",
        },
      ],
      image: questionImages.q3,
      progressWidth: 1081,
    },
    {
      id: 4,
      title:
        "On weekend evening,\nwhat scent style do you prefer?",
      options: [
        {
          key: "E",
          text: "A rich, captivating, and expressive scent,\nhoping to be the most memorable\nfocus of a gathering.",
        },
        {
          key: "I",
          text: "A restrained, layered, and comfortable scent;\nmy ritual when alone,\nlingering for those who know me.",
        },
      ],
      image: questionImages.q4,
      progressWidth: 1400,
    },
  ],
};

const translations: Record<Language, TextContent> = {
  "zh-TW": zh_TW_Content,
  en: en_Content,
};

const totalQuestions = 4;

// =========================================================
// App Component
// =========================================================
export default function App() {
  // ✅ 初始化分析追蹤和截圖功能
  const analytics = useAnalytics();
  const { captureAndDownload } = useScreenshot();

  useEffect(() => {
    const imagesToPreload = [
      "https://raw.githubusercontent.com/BDGOAL/SCENTATION/refs/heads/main/Scentation_logo_2025.05.26_v1_%E7%99%BD%E5%AD%97_A4.png",
      "https://raw.githubusercontent.com/BDGOAL/SCENTATION/refs/heads/main/pattern.png",
      "https://raw.githubusercontent.com/BDGOAL/SCENTATION/refs/heads/main/ChatGPT%20Image%202025%E5%B9%B412%E6%9C%8815%E6%97%A5%20%E4%B8%8B%E5%8D%8803_37_10%201%20(1).png",
      "https://raw.githubusercontent.com/BDGOAL/SCENTATION/refs/heads/main/1.png",
      "https://raw.githubusercontent.com/BDGOAL/SCENTATION/refs/heads/main/2.png",
      "https://raw.githubusercontent.com/BDGOAL/SCENTATION/refs/heads/main/3.png",
      "https://raw.githubusercontent.com/BDGOAL/SCENTATION/refs/heads/main/4.png",
      "https://images.unsplash.com/photo-1759793500112-c588839cfc6e?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&q=80&w=600",
    ];

    imagesToPreload.forEach((src) => {
      const img = new Image();
      img.src = src;
    });
  }, []);

  const [currentPage, setCurrentPage] = useState<Page>("intro");
  const [currentLang, setCurrentLang] =
    useState<Language>("zh-TW");

  // ✅ 語言切換處理
  const handleLanguageChange = useCallback((lang: Language) => {
    setCurrentLang(lang);
    analytics.trackLanguageChange(lang);
  }, [analytics]);

  // ✅ 頁面切換追蹤
  useEffect(() => {
    const pageNames = {
      intro: "Intro Page",
      nameInput: "Name Input Page",
      1: "Question 1",
      2: "Question 2",
      3: "Question 3",
      4: "Question 4",
      result: "Result Page",
      share: "Share Page",
    };
    analytics.trackPageView(pageNames[currentPage] || String(currentPage));
  }, [currentPage, analytics]);

  // ✅ 新：使用 UserAnswer 陣列記錄答案
  const [answers, setAnswers] = useState<UserAnswer[]>([]);

  const [playerName, setPlayerName] = useState<string>("");

  // ✅ 新：使用 MBTIType 和 MBTIPersonality
  const [result, setResult] = useState<{
    mbtiType: MBTIType;
    resultData: MBTIPersonality;
  } | null>(null);

  const [shareUrl, setShareUrl] = useState<string>("");

  const keyboardLetters = "ABCDEFGHIJKLMNOPQRSTUVWXYZ".split(
    "",
  );

  // Global auto-redirect to intro after 2 minutes of inactivity
  useEffect(() => {
    if (currentPage === "intro") {
      return;
    }

    let inactivityTimer: NodeJS.Timeout;

    const resetTimer = () => {
      if (inactivityTimer) {
        clearTimeout(inactivityTimer);
      }
      inactivityTimer = setTimeout(() => {
        restartQuiz();
      }, 120000);
    };

    const events = [
      "mousedown",
      "mousemove",
      "keypress",
      "scroll",
      "touchstart",
      "click",
    ];

    events.forEach((event) => {
      window.addEventListener(event, resetTimer);
    });

    resetTimer();

    return () => {
      if (inactivityTimer) {
        clearTimeout(inactivityTimer);
      }
      events.forEach((event) => {
        window.removeEventListener(event, resetTimer);
      });
    };
  }, [currentPage]);

  const texts = translations[currentLang];
  const questions = texts.questions;
  const resultsMap = texts.resultsMap;

  const calculateResult = useCallback(() => {
    const mbtiType = calcMbti(answers);
    const resultData = mbtiResults[mbtiType];

    setResult({ mbtiType, resultData });

    // ✅ 追蹤測驗完成和MBTI結果
    analytics.trackQuizComplete(mbtiType, playerName);
    analytics.trackMBTIResult(mbtiType);

    // 生成分享URL (GitHub Pages格式)
    const baseUrl = window.location.origin + window.location.pathname;
    const params = new URLSearchParams({
      name: playerName || "",
      type: mbtiType,
      category: resultData.category,
    });
    setShareUrl(`${baseUrl}?${params.toString()}`);

    setCurrentPage("result");
  }, [answers, playerName, analytics]);

  const handleAnswer = useCallback(
    (
      question: number,
      answer: "A" | "B",
      isLastQuestion: boolean = false,
    ) => {
      // ✅ 追蹤問題回答
      const questionMeta = questionMetaMap[question];
      if (questionMeta) {
        analytics.trackQuestionAnswer(
          question,
          answer,
          questionMeta.dimension
        );
      }

      // 添加答案到 answers 陣列
      setAnswers((prev) => [...prev, { question, answer }]);

      if (isLastQuestion) {
        // 等待狀態更新後計算結果
        setTimeout(() => {
          calculateResult();
        }, 50);
      } else {
        setCurrentPage((prevPage) => {
          if (
            typeof prevPage === "number" &&
            prevPage < totalQuestions
          ) {
            return (prevPage + 1) as 1 | 2 | 3 | 4;
          }
          return prevPage;
        });
      }
    },
    [calculateResult, analytics],
  );

  const startQuiz = useCallback(() => {
    setCurrentPage("nameInput");
  }, []);

  const beginQuestions = useCallback(() => {
    setPlayerName((prev) =>
      prev && prev.trim() ? prev.trim() : "",
    );
    setCurrentPage(1);
  }, []);

  const restartQuiz = useCallback(() => {
    // ✅ 追蹤重新測驗
    analytics.trackRestart(String(currentPage));
    
    setCurrentPage("intro");
    setAnswers([]);
    setResult(null);
    setPlayerName("");
    setShareUrl("");
  }, [analytics, currentPage]);

  const exitToIntro = useCallback(() => {
    restartQuiz();
  }, [restartQuiz]);

  const goToSharePage = useCallback(() => {
    if (!shareUrl || !result) return;
    
    // ✅ 追蹤分享行為
    analytics.trackShare(result.mbtiType, "qr_code");
    analytics.trackPageView("Share Page");
    
    setCurrentPage("share");
  }, [shareUrl, result, analytics]);

  const backToResultPage = useCallback(() => {
    setCurrentPage("result");
  }, []);

  // ✅ 新增：截圖下載功能
  const handleScreenshot = useCallback(async () => {
    if (!result) return;
    
    const filename = `SCENTATION_${result.mbtiType}_${playerName || "Result"}`;
    const success = await captureAndDownload("result-page-content", filename);
    
    if (success) {
      // ✅ 追蹤截圖下載
      analytics.trackScreenshot(result.mbtiType);
    }
  }, [result, playerName, captureAndDownload, analytics]);

  const showExitButton =
    currentPage !== "intro" &&
    currentPage !== "result" &&
    currentPage !== "share";

  return (
    <div
      className="app-container relative bg-[#1A1A1A]"
      style={{
        boxSizing: "border-box",
        width: "2160px",
        height: "3840px",
      }}
    >
      {/* 背景 */}
      <div
        className="absolute"
        style={{
          width: "2160px",
          height: "3840px",
          left: "0px",
          top: "0px",
        }}
      >
        <img
          src="https://raw.githubusercontent.com/BDGOAL/SCENTATION/refs/heads/main/pattern.png"
          alt=""
          style={{
            width: "100%",
            height: "100%",
            objectFit: "cover",
          }}
        />
      </div>

      {/* BG Container */}
      <div
        className="absolute"
        style={{
          width: "1722px",
          height: "3392px",
          left: currentPage === "intro" ? "220px" : "219px",
          top: currentPage === "intro" ? "222px" : "216px",
          background:
            currentPage !== "result"
              ? "linear-gradient(165.55deg, #1A1A1A 0%, #2B2B2B 100%)"
              : "",
          boxShadow:
            currentPage !== "result"
              ? "0px 0px 39.9px 1px #D4AF37"
              : "",
          borderRadius: "35px",
        }}
      >
        {/* Logo */}
        <div
          className="absolute"
          style={{
            width:
              currentPage === "result" ||
              currentPage === "share"
                ? "864px"
                : "75%",
            height:
              currentPage === "result" ||
              currentPage === "share"
                ? "235px"
                : "auto",
            left:
              currentPage === "result" ||
              currentPage === "share"
                ? "calc(50% - 864px/2 + 1px)"
                : "12.5%",
            top:
              currentPage === "result" ||
              currentPage === "share"
                ? "10px"
                : "50px",
          }}
        >
          <img
            src={logoImage}
            alt="SCENTATION Logo"
            style={{
              width: "100%",
              height: "auto",
              objectFit: "contain",
              display: "block",
            }}
          />
        </div>

        {/* Language Toggle（Intro / Name / Questions 才顯示） */}
        {currentPage !== "result" &&
          currentPage !== "share" && (
            <div
              className="absolute"
              style={{
                width: "553.5px",
                height: "108px",
                left: currentPage === "intro" 
                  ? "calc(50% - 553.5px/2)"
                  : "auto",
                right: currentPage === "intro" 
                  ? "auto"
                  : "60px",
                top: currentPage === "intro" 
                  ? (currentLang === "en" ? "2616px" : "2576px")
                  : "3204px",
              }}
            >
              {/* Chinese Button */}
              <div
                className="absolute"
                style={{
                  width: "266.75px",
                  height: "108px",
                  left: "0px",
                  top: "0px",
                }}
              >
                <div
                  className="absolute"
                  style={{
                    width: "266.75px",
                    height: "108px",
                    left: "0px",
                    top: "0px",
                    background:
                      currentLang === "zh-TW"
                        ? "#B8860B"
                        : "#383838",
                    borderRadius: "25px",
                  }}
                />
                <button
                  onClick={() => handleLanguageChange("zh-TW")}
                  className="absolute"
                  style={{
                    width: "266.75px",
                    height: "75.47px",
                    left: "0px",
                    top: "17.12px",
                    fontFamily: "'Inter', sans-serif",
                    fontStyle: "normal",
                    fontWeight: 400,
                    fontSize: "50px",
                    lineHeight: "61px",
                    textAlign: "center",
                    color: "#FFFFFF",
                    background: "transparent",
                    border: "none",
                    cursor: "pointer",
                  }}
                >
                  繁體
                </button>
              </div>

              {/* English Button */}
              <div
                className="absolute"
                style={{
                  width: "266.75px",
                  height: "108px",
                  left: "286.75px",
                  top: "0px",
                }}
              >
                <div
                  className="absolute"
                  style={{
                    width: "266.75px",
                    height: "108px",
                    left: "0px",
                    top: "0px",
                    background:
                      currentLang === "en"
                        ? "#B8860B"
                        : "#383838",
                    borderRadius: "25px",
                  }}
                />
                <button
                  onClick={() => handleLanguageChange("en")}
                  className="absolute"
                  style={{
                    width: "256.34px",
                    height: "75.47px",
                    left: "5.21px",
                    top: "17.12px",
                    fontFamily: "'Inter', sans-serif",
                    fontStyle: "normal",
                    fontWeight: 400,
                    fontSize: "50px",
                    lineHeight: "61px",
                    textAlign: "center",
                    color: "#FFFFFF",
                    background: "transparent",
                    border: "none",
                    cursor: "pointer",
                  }}
                >
                  English
                </button>
              </div>
            </div>
          )}

        {/* Exit Button（非 intro / result / share） */}
        {showExitButton && (
          <>
            <div
              className="absolute"
              style={{
                boxSizing: "border-box",
                width: "132px",
                height: "132px",
                left: "74px",
                top: "71px",
                border: "5px solid #B8860B",
                borderRadius: "50%",
              }}
            />
            <button
              onClick={exitToIntro}
              className="absolute"
              style={{
                width: "132px",
                height: "132px",
                left: "74px",
                top: "71px",
                background: "transparent",
                border: "none",
                cursor: "pointer",
                display: "flex",
                alignItems: "center",
                justifyContent: "center",
                fontFamily: "'Inter', sans-serif",
                fontSize: "60px",
                color: "#B8860B",
              }}
            >
              {texts.exit}
            </button>
          </>
        )}

        {/* Exit Button on Share Page */}
        {currentPage === "share" && (
          <>
            <div
              className="absolute"
              style={{
                boxSizing: "border-box",
                width: "132px",
                height: "132px",
                left: "74px",
                top: "71px",
                border: "5px solid #B8860B",
                borderRadius: "50%",
              }}
            />
            <button
              onClick={exitToIntro}
              className="absolute"
              style={{
                width: "132px",
                height: "132px",
                left: "74px",
                top: "71px",
                background: "transparent",
                border: "none",
                cursor: "pointer",
                display: "flex",
                alignItems: "center",
                justifyContent: "center",
                fontFamily: "'Inter', sans-serif",
                fontSize: "60px",
                color: "#B8860B",
              }}
            >
              {texts.exit}
            </button>
          </>
        )}

        {/* ===== INTRO PAGE ===== */}
        {currentPage === "intro" && (
          <>
            {/* Decorative Lines Group 6 */}
            <div
              style={{
                position: "absolute",
                width: "1330px",
                height: "38px",
                left: "calc(50% - 1330px/2)",
                top: "464px",
              }}
            >
              <div
                style={{
                  position: "absolute",
                  width: "1330px",
                  height: "0px",
                  left: "0px",
                  top: "0px",
                  border: "6px solid #D4AF37",
                }}
              />
              <div
                style={{
                  position: "absolute",
                  width: "1330px",
                  height: "0px",
                  left: "0px",
                  top: "38px",
                  border: "12px solid #D4AF37",
                }}
              />
            </div>

            {/* Tagline */}
            <div
              className="absolute"
              style={{
                width: "1280px",
                height: "77px",
                left: "calc(50% - 1280px/2)",
                top: "571px",
                fontFamily: "'Inter', sans-serif",
                fontStyle: "normal",
                fontWeight: 400,
                fontSize:
                  currentLang === "en" ? "48px" : "64px",
                lineHeight:
                  currentLang === "en" ? "60px" : "77px",
                textAlign: "center",
                color: "#D4AF37",
              }}
            >
              {currentLang === "zh-TW"
                ? "為您的非凡風格，尋覓您的品味哲學"
                : texts.header.tagline}
            </div>

            {/* Title */}
            <div
              className="absolute"
              style={{
                width: "1482px",
                height: "256px",
                left: "calc(50% - 1482px/2)",
                top: currentLang === "en" ? "723px" : "673px",
                fontFamily: "'Inter', sans-serif",
                fontStyle: "normal",
                fontWeight: 700,
                fontSize:
                  currentLang === "en" ? "120px" : "150px",
                lineHeight:
                  currentLang === "en" ? "140px" : "182px",
                textAlign: "center",
                color: "#D4AF37",
              }}
            >
              {texts.intro.title}
            </div>

            {/* Description */}
            <div
              className="absolute"
              style={{
                width: "1400px",
                height: "272px",
                left: "calc(50% - 1400px/2)",
                top: currentLang === "en" ? "880px" : "890px",
                fontFamily: "'Inter', sans-serif",
                fontStyle: "normal",
                fontWeight: 400,
                fontSize: "40px",
                lineHeight: "48px",
                textAlign: "center",
                color: "#D4AF37",
              }}
            >
              {texts.intro.description}
            </div>

            {/* Decorative Lines Group 5 */}
            <div
              style={{
                position: "absolute",
                width: "1331px",
                height: "38px",
                left: "calc(50% - 1331px/2 + 0.5px)",
                top: "1056px",
              }}
            >
              <div
                style={{
                  position: "absolute",
                  width: "1331px",
                  height: "0px",
                  left: "0px",
                  top: "0px",
                  border: "12px solid #D4AF37",
                  transform: "matrix(1, 0, 0, -1, 0, 0)",
                }}
              />
              <div
                style={{
                  position: "absolute",
                  width: "1331px",
                  height: "0px",
                  left: "0px",
                  top: "38px",
                  border: "6px solid #D4AF37",
                  transform: "matrix(1, 0, 0, -1, 0, 0)",
                }}
              />
            </div>

            {/* Main Image (Intro) */}
            <div
              className="absolute"
              style={{
                width: "1148px",
                height: "1200px",
                left: "calc(50% - 1148px/2 - 2px)",
                top: currentLang === "en" ? "1269px" : "1239px",
                borderRadius: "25px",
                overflow: "hidden",
              }}
            >
              <img
                src={questionImages.intro}
                alt=""
                style={{
                  width: "1000%",
                  height: "100%",
                  objectFit: "cover",
                }}
              />
            </div>

            {/* Start Button */}
            <button
              onClick={startQuiz}
              style={{
                position: "absolute",
                width:
                  currentLang === "en" ? "1050px" : "923px",
                height: "210px",
                left:
                  currentLang === "en"
                    ? "calc(50% - 1050px/2)"
                    : "calc(50% - 923px/2 + 0.5px)",
                top: currentLang === "en" ? "2152px" : "2092px",
                background: "#B8860B",
                boxShadow: "0px 0px 18px 9px #FFFFFF",
                borderRadius: "25px",
                border: "none",
                cursor: "pointer",
                fontFamily: "'Inter', sans-serif",
                fontStyle: "normal",
                fontWeight: 700,
                fontSize:
                  currentLang === "en" ? "64px" : "96px",
                lineHeight: "116px",
                textAlign: "center",
                color: "#FFFFFF",
              }}
            >
              {texts.intro.button}
            </button>

            {/* White Bar */}
            <div
              style={{
                position: "absolute",
                width: "1148px",
                height: "110px",
                left: "287px",
                top: currentLang === "en" ? "2456px" : "2416px",
                background: "#FFFFFF",
                borderRadius: "0px 0px 25px 25px",
              }}
            />

            {/* Instruction Text */}
            <div
              style={{
                position: "absolute",
                width: "1000px",
                height: "87px",
                left: "calc(50% - 1000px/2)",
                top: currentLang === "en" ? "2479px" : "2439px",
                fontFamily: "'Inter', sans-serif",
                fontStyle: "normal",
                fontWeight: 700,
                fontSize:
                  currentLang === "en" ? "42px" : "55px",
                lineHeight:
                  currentLang === "en" ? "52px" : "67px",
                textAlign: "center",
                color: "#B8860B",
              }}
            >
              {currentLang === "zh-TW"
                ? "*點擊上方按鈕開始您的香味測試"
                : "*Tap the button above to start your scent quiz"}
            </div>
          </>
        )}

        {/* ===== NAME INPUT PAGE（自訂鍵盤） ===== */}
        {currentPage === "nameInput" && (
          <>
            {/* Title */}
            <div
              className="absolute"
              style={{
                width: "1482px",
                height: "200px",
                left: "calc(50% - 1482px/2)",
                top: "650px",
                fontFamily: "'Inter', sans-serif",
                fontStyle: "normal",
                fontWeight: 700,
                fontSize:
                  currentLang === "en" ? "110px" : "130px",
                lineHeight:
                  currentLang === "en" ? "130px" : "160px",
                textAlign: "center",
                color: "#B8860B",
              }}
            >
              {texts.nameInput.title}
            </div>

            {/* Subtitle */}
            <div
              className="absolute"
              style={{
                width: "1280px",
                left: "calc(50% - 1280px/2)",
                top: "880px",
                fontFamily: "'Inter', sans-serif",
                fontStyle: "normal",
                fontWeight: 400,
                fontSize:
                  currentLang === "en" ? "48px" : "56px",
                lineHeight:
                  currentLang === "en" ? "60px" : "70px",
                textAlign: "center",
                color: "#FFFFFF",
              }}
            >
              {texts.nameInput.subtitle}
            </div>

            {/* Name Display Box（僅���示，不觸發系統鍵盤） */}
            <div
              className="absolute"
              style={{
                width: "900px",
                height: "140px",
                left: "calc(50% - 900px/2)",
                top: "1100px",
                background: "#FFFFFF",
                borderRadius: "25px",
                display: "flex",
                alignItems: "center",
                padding: "0 40px",
                boxSizing: "border-box",
              }}
            >
              <div
                style={{
                  width: "100%",
                  height: "100%",
                  fontFamily: "'Inter', sans-serif",
                  fontStyle: "normal",
                  fontWeight: 400,
                  fontSize: "56px",
                  lineHeight: "68px",
                  color: playerName ? "#1A1A1A" : "#999999",
                  display: "flex",
                  alignItems: "center",
                }}
              >
                {playerName || texts.nameInput.placeholder}
              </div>
            </div>

            {/* On-screen Keyboard */}
            <div
              className="absolute"
              style={{
                width: "1400px",
                left: "calc(50% - 1400px/2)",
                top: "1350px",
                display: "flex",
                flexDirection: "column",
                alignItems: "center",
                gap: "30px",
              }}
            >
              {/* Letter keys */}
              <div
                style={{
                  width: "100%",
                  display: "flex",
                  flexWrap: "wrap",
                  justifyContent: "center",
                  gap: "20px",
                }}
              >
                {keyboardLetters.map((letter) => (
                  <button
                    key={letter}
                    onClick={() =>
                      setPlayerName((prev) =>
                        (prev + letter).slice(0, 12),
                      )
                    }
                    style={{
                      width: "150px",
                      height: "150px",
                      borderRadius: "30px",
                      border: "3px solid #B8860B",
                      background: "#2B2B2B",
                      cursor: "pointer",
                      fontFamily: "'Inter', sans-serif",
                      fontStyle: "normal",
                      fontWeight: 600,
                      fontSize: "72px",
                      color: "#FFFFFF",
                    }}
                  >
                    {letter}
                  </button>
                ))}
              </div>

              {/* Action row: 空白 / 刪除 / 開��測�� */}
              <div
                style={{
                  width: "100%",
                  display: "flex",
                  justifyContent: "center",
                  gap: "40px",
                  marginTop: "10px",
                }}
              >
                {/* Space */}
                <button
                  onClick={() =>
                    setPlayerName((prev) =>
                      (prev + " ").slice(0, 16),
                    )
                  }
                  style={{
                    width: "390px",
                    height: "150px",
                    borderRadius: "30px",
                    border: "3px solid #B8860B",
                    background: "#2B2B2B",
                    cursor: "pointer",
                    fontFamily: "'Inter', sans-serif",
                    fontStyle: "normal",
                    fontWeight: 500,
                    fontSize:
                      currentLang === "en" ? "60px" : "66px",
                    color: "#FFFFFF",
                  }}
                >
                  {currentLang === "zh-TW" ? "空白" : "Space"}
                </button>

                {/* Delete */}
                <button
                  onClick={() =>
                    setPlayerName((prev) =>
                      prev.slice(
                        0,
                        Math.max(prev.length - 1, 0),
                      ),
                    )
                  }
                  style={{
                    width: "390px",
                    height: "150px",
                    borderRadius: "30px",
                    border: "3px solid #B8860B",
                    background: "#2B2B2B",
                    cursor: "pointer",
                    fontFamily: "'Inter', sans-serif",
                    fontStyle: "normal",
                    fontWeight: 500,
                    fontSize:
                      currentLang === "en" ? "60px" : "66px",
                    color: "#FFFFFF",
                  }}
                >
                  {currentLang === "zh-TW" ? "刪除" : "Delete"}
                </button>

                {/* Confirm / Start */}
                <button
                  onClick={beginQuestions}
                  style={{
                    width: "390px",
                    height: "150px",
                    borderRadius: "30px",
                    border: "none",
                    background: "#B8860B",
                    cursor: "pointer",
                    fontFamily: "'Inter', sans-serif",
                    fontStyle: "normal",
                    fontWeight: 700,
                    fontSize:
                      currentLang === "en" ? "60px" : "66px",
                    color: "#FFFFFF",
                    boxShadow:
                      "0px 0px 18px 6px rgba(255,255,255,0.3)",
                  }}
                >
                  {texts.nameInput.button}
                </button>
              </div>
            </div>
          </>
        )}

        {/* ===== QUESTION PAGES ===== */}
        {questions.map(
          (q) =>
            currentPage === q.id && (
              <div key={q.id}>
                {/* Tagline */}
                <div
                  style={{
                    position: "absolute",
                    width: "1280px",
                    height:
                      currentLang === "en" ? "100px" : "76px",
                    left: "220px",
                    top: "676px",
                    fontFamily: "'Inter', sans-serif",
                    fontStyle: "normal",
                    fontWeight: 400,
                    fontSize:
                      currentLang === "en" ? "48px" : "64px",
                    lineHeight:
                      currentLang === "en" ? "58px" : "77px",
                    textAlign: "center",
                    color: "#FFFFFF",
                  }}
                >
                  {texts.header.tagline}
                </div>

                {/* Progress Bar Background */}
                <div
                  style={{
                    position: "absolute",
                    width: "1400px",
                    height: "48px",
                    left: "160px",
                    top:
                      currentLang === "en" ? "828px" : "804px",
                    background: "#333333",
                    borderRadius: "43px",
                  }}
                />

                {/* Progress Bar Fill */}
                <div
                  style={{
                    position: "absolute",
                    width: `${q.progressWidth}px`,
                    height: "48px",
                    left: "160px",
                    top:
                      currentLang === "en" ? "828px" : "804px",
                    background: "#B8860B",
                    borderRadius: "43px",
                    transition: "width 0.5s",
                  }}
                />

                {/* Question Title */}
                <div
                  style={{
                    position: "absolute",
                    width:
                      currentLang === "en" &&
                      (currentPage === 2 || currentPage === 4)
                        ? "1400px"
                        : "1182px",
                    height:
                      currentLang === "en" ? "250px" : "204px",
                    left:
                      currentLang === "en" &&
                      (currentPage === 2 || currentPage === 4)
                        ? "calc(50% - 1400px/2)"
                        : "calc(50% - 1182px/2)",
                    top:
                      currentLang === "en" ? "1018px" : "994px",
                    fontFamily: "'Inter', sans-serif",
                    fontStyle: "normal",
                    fontWeight: 700,
                    fontSize:
                      currentLang === "en" ? "80px" : "96px",
                    lineHeight:
                      currentLang === "en" ? "96px" : "116px",
                    textAlign: "center",
                    color: "#B8860B",
                    whiteSpace: "pre-line",
                  }}
                >
                  {q.title}
                </div>

                {/* Question Image */}
                <div
                  style={{
                    position: "absolute",
                    width: "1309px",
                    height: "602px",
                    left: "calc(50% - 1309px/2 + 0.5px)",
                    top:
                      currentLang === "en"
                        ? "1348px"
                        : "1298px",
                    borderRadius: "25px",
                    overflow: "hidden",
                  }}
                >
                  <img
                    src={q.image}
                    alt=""
                    style={{
                      width: "100%",
                      height: "100%",
                      objectFit: "cover",
                    }}
                  />
                </div>

                {/* Option A Group */}
                <div
                  style={{
                    position: "absolute",
                    width: "1449px",
                    left: "calc(50% - 1449px/2 + 0.5px)",
                    top:
                      currentLang === "en"
                        ? "2047px"
                        : "1997px",
                  }}
                >
                  {/* A Letter */}
                  <div
                    style={{
                      position: "absolute",
                      width: "134px",
                      height: "107px",
                      left: "calc(50% - 134px/2 - 656px)",
                      top: "15px",
                      fontFamily: "'Playfair', serif",
                      fontStyle: "normal",
                      fontWeight: 400,
                      fontSize: "128px",
                      lineHeight: "154px",
                      textAlign: "center",
                      color: "#FFFFFF",
                      pointerEvents: "none",
                    }}
                  >
                    <img
                      src={iconA}
                      alt="A"
                      style={{
                        width: "150%",
                        height: "150%",
                        objectFit: "contain",
                      }}
                    />
                  </div>

                  {/* Option A Button */}
                  <button
                    onClick={() =>
                      handleAnswer(
                        q.id,
                        "A",
                        q.id === totalQuestions,
                      )
                    }
                    style={{
                      position: "absolute",
                      boxSizing: "border-box",
                      width: "1288px",
                      height:
                        currentLang === "en"
                          ? "260px"
                          : "245px",
                      left: "calc(50% - 1288px/2 + 80px)",
                      top: "0px",
                      border: "6px solid #FFFFFF",
                      borderRadius: "25px",
                      background: "transparent",
                      cursor: "pointer",
                    }}
                  >
                    <div
                      style={{
                        width: "1236px",
                        margin: "0 auto",
                        fontFamily: "'Inter', sans-serif",
                        fontStyle: "normal",
                        fontWeight: 400,
                        fontSize:
                          currentLang === "en"
                            ? "50px"
                            : "70px",
                        lineHeight:
                          currentLang === "en"
                            ? "62px"
                            : "85px",
                        textAlign: "center",
                        color: "#FFFFFF",
                        whiteSpace: "pre-line",
                      }}
                    >
                      {q.options[0].text}
                    </div>
                  </button>
                </div>

                {/* Option B Group */}
                <div
                  style={{
                    position: "absolute",
                    width: "1449px",
                    left: "calc(50% - 1449px/2 + 0.5px)",
                    top:
                      currentLang === "en"
                        ? "2354px"
                        : "2289px",
                  }}
                >
                  {/* B Letter */}
                  <div
                    style={{
                      position: "absolute",
                      width: "134px",
                      height: "107px",
                      left: "calc(50% - 134px/2 - 656px)",
                      top: "21px",
                      fontFamily: "'Playfair', serif",
                      fontStyle: "normal",
                      fontWeight: 400,
                      fontSize: "128px",
                      lineHeight: "154px",
                      textAlign: "center",
                      color: "#FFFFFF",
                      pointerEvents: "none",
                    }}
                  >
                    <img
                      src={iconB}
                      alt="B"
                      style={{
                        width: "150%",
                        height: "150%",
                        objectFit: "contain",
                      }}
                    />
                  </div>

                  {/* Option B Button */}
                  <button
                    onClick={() =>
                      handleAnswer(
                        q.id,
                        "B",
                        q.id === totalQuestions,
                      )
                    }
                    style={{
                      position: "absolute",
                      boxSizing: "border-box",
                      width: "1288px",
                      height:
                        currentLang === "en"
                          ? "260px"
                          : "242px",
                      left: "calc(50% - 1288px/2 + 81px)",
                      top: "0px",
                      border: "6px solid #FFFFFF",
                      borderRadius: "25px",
                      background: "transparent",
                      cursor: "pointer",
                    }}
                  >
                    <div
                      style={{
                        width: "1202px",
                        margin: "0 auto",
                        fontFamily: "'Inter', sans-serif",
                        fontStyle: "normal",
                        fontWeight: 400,
                        fontSize:
                          currentLang === "en"
                            ? "50px"
                            : "70px",
                        lineHeight:
                          currentLang === "en"
                            ? "62px"
                            : "85px",
                        textAlign: "center",
                        color: "#FFFFFF",
                        whiteSpace: "pre-line",
                      }}
                    >
                      {q.options[1].text}
                    </div>
                  </button>
                </div>
              </div>
            ),
        )}

        {/* ===== RESULT PAGE ===== */}
        {currentPage === "result" && result && (
          <ResultPage
            result={result}
            playerName={playerName}
            currentLang={currentLang}
            shareUrl={shareUrl}
            restartQuiz={restartQuiz}
            goToSharePage={goToSharePage}
            onScreenshot={handleScreenshot}
          />
        )}

        {/* ===== SHARE QR PAGE ===== */}
        {currentPage === "share" && result && shareUrl && (
          <>
            {/* Title */}
            <div
              style={{
                position: "absolute",
                width: "1482px",
                height: "200px",
                left: "calc(50% - 1482px/2)",
                top: "650px",
                fontFamily: "'Inter', sans-serif",
                fontStyle: "normal",
                fontWeight: 700,
                fontSize:
                  currentLang === "en" ? "110px" : "130px",
                lineHeight:
                  currentLang === "en" ? "130px" : "160px",
                textAlign: "center",
                color: "#B8860B",
              }}
            >
              {texts.shareQR.title}
            </div>

            {/* Subtitle */}
            <div
              style={{
                position: "absolute",
                width: "1280px",
                left: "calc(50% - 1280px/2)",
                top: "880px",
                fontFamily: "'Inter', sans-serif",
                fontStyle: "normal",
                fontWeight: 400,
                fontSize:
                  currentLang === "en" ? "48px" : "56px",
                lineHeight:
                  currentLang === "en" ? "60px" : "70px",
                textAlign: "center",
                color: "#FFFFFF",
              }}
            >
              {texts.shareQR.subtitle}
            </div>

            {/* QR Code Container */}
            <div
              style={{
                position: "absolute",
                width: "600px",
                height: "600px",
                left: "calc(50% - 600px/2)",
                top: "1100px",
                background: "#FFFFFF",
                borderRadius: "30px",
                display: "flex",
                alignItems: "center",
                justifyContent: "center",
                padding: "40px",
                boxSizing: "border-box",
              }}
            >
              <QRCode value={shareUrl} size={500} />
            </div>

            {/* Instruction */}
            <div
              style={{
                position: "absolute",
                width: "1280px",
                left: "calc(50% - 1280px/2)",
                top: "1800px",
                fontFamily: "'Inter', sans-serif",
                fontStyle: "normal",
                fontWeight: 400,
                fontSize:
                  currentLang === "en" ? "42px" : "44px",
                lineHeight:
                  currentLang === "en" ? "54px" : "53px",
                textAlign: "center",
                color: "#FFFFFF",
                whiteSpace: "pre-line",
              }}
            >
              {texts.shareQR.instruction}
            </div>

            {/* Back Button */}
            <button
              onClick={backToResultPage}
              style={{
                position: "absolute",
                width: currentLang === "en" ? "800px" : "600px",
                height: "150px",
                left:
                  currentLang === "en"
                    ? "calc(50% - 800px/2)"
                    : "calc(50% - 600px/2)",
                bottom: "220px",
                background: "#B8860B",
                boxShadow:
                  "0px 0px 18px 9px rgba(255, 255, 255, 0.3)",
                borderRadius: "25px",
                border: "none",
                cursor: "pointer",
                fontFamily: "'Inter', sans-serif",
                fontStyle: "normal",
                fontWeight: 700,
                fontSize:
                  currentLang === "en" ? "56px" : "72px",
                lineHeight: "87px",
                textAlign: "center",
                color: "#FFFFFF",
              }}
            >
              {texts.shareQR.backButton}
            </button>
          </>
        )}
      </div>
      {/* Bottom Black Bar - Rectangle 19 */}
      {currentPage === "result" && result && (
        <div
          style={{
            position: "absolute",
            width: "2160px",
            height: "260px",
            left: "calc(50% - 2160px/2)",
            bottom: "0px",
            background: "#000000",
            zIndex: 2,
          }}
        >
          {/* Logo - Scentation_logo_白字 2 */}
          <img
            src={logoImage}
            alt="Scentation Logo"
            style={{
              position: "absolute",
              width: "623px",
              height: "170px",
              left: "calc(50% - 623px/2 - 540.5px)",
              top: "48px",
              objectFit: "contain",
            }}
          />

          {/* Share Text - 分享測驗結果給朋友，看看他們是哪一種香氣個性 */}
          <div
            style={{
              position: "absolute",
              width: "886px",
              height: "72px",
              left: "calc(50% - 886px/2 + 400px)",
              top: "83px",
              fontFamily: "'Inter', sans-serif",
              fontStyle: "normal",
              fontWeight: 400,
              fontSize: "38px",
              lineHeight: "46px",
              color: "#FFFFFF",
            }}
          >
            {currentLang === "zh-TW"
              ? "分享測驗結果給朋友，看看他們是哪一種香氣個性"
              : "Share your results with friends to see their scent personality"}
          </div>

          {/* Instagram Icon - ig-14 1 */}
          <img
            src="https://raw.githubusercontent.com/BDGOAL/SCENTATION/refs/heads/main/ig-14.png"
            alt="Instagram"
            style={{
              position: "absolute",
              width: "35px",
              height: "38px",
              left: "1037px",
              top: "146px",
              objectFit: "contain",
            }}
          />

          {/* Instagram Handle - scentation_official */}
          <div
            style={{
              position: "absolute",
              width: "479px",
              height: "78px",
              left: "calc(50% - 479px/2 + 239.5px)",
              top: "140px",
              fontFamily: "'Inter', sans-serif",
              fontStyle: "normal",
              fontWeight: 400,
              fontSize: "38px",
              lineHeight: "46px",
              color: "#FFFFFF",
            }}
          >
            scentation_official
          </div>
        </div>
      )}
    </div>
  );
}
